<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Venus Trading</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: rgb(1,1,36);
      color: white;
      font-family: 'Arial', sans-serif;
      overflow-x: hidden;
    }
    .mainpage {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    .head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
    }
    .headimg {
      width: 40px;
      height: 40px;
      cursor: pointer;
    }
    .real .amount p {
      font-size: 12px;
      color: #aaa;
      margin-bottom: 5px;
    }
    .real .amount h1 {
      font-size: 24px;
      font-weight: bold;
    }
    .down {
      font-size: 14px;
      margin-left: 5px;
    }
    select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    select option {
      background: rgb(1,1,36);
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 400px;
      margin: 20px 0;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgb(1,1,36);
      overflow: hidden;
      touch-action: pan-x;
    }
    #chart {
      width: 100% !important;
      height: 100% !important;
      cursor: grab;
    }
    #chart:active {
      cursor: grabbing;
    }
    .trade-marker {
      position: absolute;
      right: 10px;
      background: rgba(0,0,0,0.8);
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 14px;
      z-index: 10;
      border-left: 3px solid;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .trade-marker.buy { border-color: #00ff88; }
    .trade-marker.sell { border-color: #ff4444; }
    .countdown {
      font-size: 16px;
      font-weight: bold;
    }
    .entry-price {
      font-size: 12px;
      color: #aaa;
    }
    .time-amount {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }
    .time-amount label {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 5px;
    }
    .profit {
      text-align: center;
      color: #00ff88;
      font-size: 18px;
      font-weight: bold;
      margin: 20px 0;
    }
    .buy-sell {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    .buy, .sell {
      flex: 1;
      padding: 18px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .buy {
      background: linear-gradient(135deg, #00ff88, #00cc66);
      color: #000;
    }
    .buy:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,255,136,0.4);
    }
    .buy:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
    }
    .sell {
      background: linear-gradient(135deg, #ff4444, #cc0000);
      color: white;
    }
    .sell:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,68,68,0.4);
    }
    .sell:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
    }
    .or {
      font-size: 14px;
      color: #666;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }
    .stat-item {
      text-align: center;
    }
    .stat-item .label {
      font-size: 11px;
      color: #aaa;
      margin-bottom: 5px;
    }
    .stat-item .value {
      font-size: 16px;
      font-weight: bold;
    }
    .stat-item .value.green { color: #00ff88; }
    .stat-item .value.red { color: #ff4444; }
  </style>
</head>
<body>
  <div class="mainpage">
    <div class="head">
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%2300ff88'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='%23000' font-weight='bold'%3EV%3C/text%3E%3C/svg%3E" alt="Venus" class="headimg" />
      <div class="real">
        <div class="amount">
          <p>Real USD</p>
          <h1 id="balanceDisplay">1000.00 <span class="down">🔽</span></h1>
        </div>
      </div>
    </div>

    <div>
      <select id="trade">
        <option value="EUR/USD">EUR/USD</option>
        <option value="GBP/USD">GBP/USD</option>
        <option value="USD/JPY">USD/JPY</option>
        <option value="USD/CHF">USD/CHF</option>
        <option value="AUD/USD">AUD/USD</option>
        <option value="BTC/USD">BTC/USD</option>
        <option value="ETH/USD">ETH/USD</option>
        <option value="XRP/USD">XRP/USD</option>
        <option value="LTC/USD">LTC/USD</option>
        <option value="NZD/USD">NZD/USD</option>
        <option value="EUR/GBP">EUR/GBP</option>
      </select>
    </div>

    <div class="chart-container">
      <canvas id="chart"></canvas>
      <div id="tradeMarker"></div>
    </div>

    <div>
      <div class="time-amount">
        <label for="timer">Time</label>
        <select id="timer">
          <option value="5">5 Seconds</option>
          <option value="30">30 Seconds</option>
          <option value="60">1 Minute</option>
          <option value="300">5 Minutes</option>
          <option value="900">15 Minutes</option>
          <option value="1800">30 Minutes</option>
          <option value="3600">1 Hour</option>
          <option value="14400">4 Hours</option>
          <option value="28800">8 Hours</option>
          <option value="86400">24 Hours</option>
          <option value="172800">48 Hours</option>
        </select>

        <label for="amount">Amount in USD</label>
        <select id="amount">
          <option value="1">$1</option>
          <option value="5">$5</option>
          <option value="10" selected>$10</option>
          <option value="20">$20</option>
          <option value="30">$30</option>
          <option value="50">$50</option>
          <option value="100">$100</option>
          <option value="200">$200</option>
          <option value="500">$500</option>
          <option value="1000">$1000</option>
        </select>
      </div>
      <p class="profit">Profit +95%</p>
      <div class="buy-sell">
        <button class="buy" id="buyBtn">⬆ BUY</button>
        <p class="or">OR</p>
        <button class="sell" id="sellBtn">⬇ SELL</button>
      </div>
    </div>

    <div class="stats">
      <div class="stat-item">
        <div class="label">Total Trades</div>
        <div class="value" id="totalTrades">0</div>
      </div>
      <div class="stat-item">
        <div class="label">Wins</div>
        <div class="value green" id="wins">0</div>
      </div>
      <div class="stat-item">
        <div class="label">Losses</div>
        <div class="value red" id="losses">0</div>
      </div>
    </div>
  </div>

  <script>
    const ctx = document.getElementById("chart").getContext("2d");
    let balance = parseFloat(window.localStorage.getItem('balance')) || 1000.0;
    let stats = JSON.parse(window.localStorage.getItem('stats')) || { total: 0, wins: 0, losses: 0 };
    let pairData = JSON.parse(window.localStorage.getItem('pairData')) || {};
    let activeTrade = JSON.parse(window.localStorage.getItem('activeTrade')) || null;
    let currentPair = window.localStorage.getItem('currentPair') || "EUR/USD";
    let tradeLineDataset = null;
    let countdownInterval = null;
    let viewOffset = 0;
    let isDragging = false;
    let startX = 0;
    let isLiveMode = true;
    let lastUpdateTime = parseInt(window.localStorage.getItem('lastUpdateTime')) || Date.now();

    function saveToStorage() {
      window.localStorage.setItem('balance', balance.toFixed(2));
      window.localStorage.setItem('activeTrade', JSON.stringify(activeTrade));
      window.localStorage.setItem('stats', JSON.stringify(stats));
      window.localStorage.setItem('pairData', JSON.stringify(pairData));
      window.localStorage.setItem('currentPair', currentPair);
      window.localStorage.setItem('lastUpdateTime', Date.now().toString());
    }

    function updateBalanceDisplay() {
      document.getElementById("balanceDisplay").innerText = balance.toFixed(2) + " 🔽";
    }

    function updateStatsDisplay() {
      document.getElementById("totalTrades").innerText = stats.total;
      document.getElementById("wins").innerText = stats.wins;
      document.getElementById("losses").innerText = stats.losses;
    }

    function generateData(pair) {
      if (!pairData[pair]) {
        pairData[pair] = {
          base: 1.0 + Math.random() * 0.2,
          data: Array.from({ length: 500 }, () => 1 + (Math.random() - 0.5) * 0.01),
          history: [],
          seed: Math.random() * 1000,
          phase: Math.random() * Math.PI * 2,
          trend: (Math.random() - 0.5) * 0.0002
        };
        saveToStorage();
      }
      return pairData[pair];
    }

    // Simulate missed updates while page was closed
    function simulateMissedUpdates() {
      const now = Date.now();
      const timeDiff = now - lastUpdateTime;
      const missedUpdates = Math.floor(timeDiff / 200); // Average 200ms per update
      
      if (missedUpdates > 0 && missedUpdates < 10000) { // Cap at 10000 to prevent freezing
        Object.keys(pairData).forEach(pair => {
          const pairInfo = pairData[pair];
          for (let i = 0; i < missedUpdates; i++) {
            const last = pairInfo.data[pairInfo.data.length - 1];
            const time = (now - timeDiff + (i * 200)) / 1000;
            const next = last + 
              (Math.random() - 0.5) * 0.004 + 
              Math.sin(time + pairInfo.phase) * 0.0008 + 
              Math.cos(time * 0.5 + pairInfo.seed) * 0.0006 +
              pairInfo.trend;
            
            pairInfo.history.push(pairInfo.data[0]);
            if (pairInfo.history.length > 10000) pairInfo.history.shift();
            
            pairInfo.data.push(next);
            pairInfo.data.shift();
          }
        });
        saveToStorage();
      }
      lastUpdateTime = now;
    }

    const liveChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: Array.from({ length: 500 }, (_, i) => i),
        datasets: [{
          label: "Live " + currentPair,
          data: generateData(currentPair).data,
          borderColor: "#00ff88",
          borderWidth: 2,
          fill: false,
          tension: 0.3,
          pointRadius: 0,
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        scales: {
          x: { display: false },
          y: {
            display: true,
            position: 'left',
            grid: { color: "rgba(255,255,255,0.1)", lineWidth: 1 },
            ticks: { 
              color: "#ccc", 
              font: { size: 11 },
              padding: 8,
              callback: function(value) {
                return value.toFixed(5);
              }
            },
          },
        },
        plugins: { 
          legend: { display: false },
          tooltip: { enabled: false }
        },
        layout: {
          padding: {
            right: 50
          }
        }
      },
    });

    let speeds = [80, 120, 200, 300, 500, 150, 250, 400];
    let speedIndex = 0;
    
    function updateChart() {
      if (isLiveMode) {
        const { data, history, phase, seed, trend } = generateData(currentPair);
        const last = data[data.length - 1];
        const time = Date.now() / 1000;
        const next = last + 
          (Math.random() - 0.5) * 0.004 + 
          Math.sin(time + phase) * 0.0008 + 
          Math.cos(time * 0.5 + seed) * 0.0006 +
          trend;
        
        history.push(data[0]);
        if (history.length > 10000) history.shift();
        
        data.push(next);
        data.shift();
        
        liveChart.data.datasets[0].data = data;
        
        if (tradeLineDataset) {
          tradeLineDataset.data.push(tradeLineDataset.data[0]);
          tradeLineDataset.data.shift();
        }
        
        liveChart.update();

        if (activeTrade && Date.now() >= activeTrade.endTime) {
          settleTrade(next);
        }
        
        // Periodically save to storage
        if (Math.random() < 0.05) { // Save ~5% of the time to avoid too many writes
          saveToStorage();
        }
      }

      speedIndex = (speedIndex + 1) % speeds.length;
      setTimeout(updateChart, speeds[speedIndex]);
    }

    // Touch and mouse drag for chart scrolling
    const canvas = document.getElementById('chart');
    
    canvas.addEventListener('mousedown', (e) => {
      isDragging = true;
      startX = e.clientX;
      isLiveMode = false;
    });

    canvas.addEventListener('touchstart', (e) => {
      isDragging = true;
      startX = e.touches[0].clientX;
      isLiveMode = false;
    });

    canvas.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      const deltaX = e.clientX - startX;
      startX = e.clientX;
      scrollChart(deltaX);
    });

    canvas.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      const deltaX = e.touches[0].clientX - startX;
      startX = e.touches[0].clientX;
      scrollChart(deltaX);
    });

    canvas.addEventListener('mouseup', () => {
      isDragging = false;
      if (viewOffset <= 0) {
        viewOffset = 0;
        isLiveMode = true;
      }
    });

    canvas.addEventListener('touchend', () => {
      isDragging = false;
      if (viewOffset <= 0) {
        viewOffset = 0;
        isLiveMode = true;
      }
    });

    canvas.addEventListener('mouseleave', () => {
      isDragging = false;
    });

    function scrollChart(delta) {
      const sensitivity = 2;
      viewOffset -= Math.floor(delta / sensitivity);
      
      if (viewOffset < 0) viewOffset = 0;
      
      const { data, history } = generateData(currentPair);
      
      if (viewOffset > 0) {
        const visibleData = [...history.slice(-viewOffset - 500, -viewOffset || undefined), ...data];
        liveChart.data.datasets[0].data = visibleData.slice(-500);
        
        if (tradeLineDataset && activeTrade) {
          tradeLineDataset.data = Array(500).fill(activeTrade.entryPrice);
        }
      } else {
        liveChart.data.datasets[0].data = data;
        if (tradeLineDataset && activeTrade) {
          tradeLineDataset.data = Array(500).fill(activeTrade.entryPrice);
        }
      }
      
      liveChart.update();
    }

    document.getElementById("trade").addEventListener("change", (e) => {
      currentPair = e.target.value;
      generateData(currentPair); // Ensure pair data exists
      liveChart.data.datasets[0].label = "Live " + currentPair;
      liveChart.data.datasets[0].data = generateData(currentPair).data;
      liveChart.update();
      saveToStorage();
    });

    function startCountdown(duration) {
      const markerDiv = document.getElementById("tradeMarker");
      const countdownEl = markerDiv.querySelector('.countdown');
      
      if (countdownInterval) clearInterval(countdownInterval);
      
      countdownInterval = setInterval(() => {
        const remaining = Math.max(0, Math.ceil((activeTrade.endTime - Date.now()) / 1000));
        
        if (remaining <= 0) {
          clearInterval(countdownInterval);
          countdownEl.textContent = "Settling...";
        } else {
          const mins = Math.floor(remaining / 60);
          const secs = remaining % 60;
          countdownEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }
      }, 1000);
    }

    function startTrade(side) {
      const amount = parseFloat(document.getElementById("amount").value);
      const duration = parseInt(document.getElementById("timer").value);

      if (amount > balance) {
        alert("Insufficient balance!");
        return;
      }

      if (activeTrade) {
        alert("Please wait for current trade to finish!");
        return;
      }

      balance -= amount;
      updateBalanceDisplay();

      const entryPrice = liveChart.data.datasets[0].data.slice(-1)[0];

      tradeLineDataset = {
        label: side === "buy" ? "BUY Entry" : "SELL Entry",
        data: Array(500).fill(entryPrice),
        borderColor: side === "buy" ? "#00ff88" : "#ff4444",
        borderWidth: 2,
        borderDash: [5, 5],
        pointRadius: 0,
        fill: false,
      };
      
      liveChart.data.datasets.push(tradeLineDataset);
      liveChart.update();

      activeTrade = { 
        side, 
        amount, 
        entryPrice, 
        endTime: Date.now() + duration * 1000,
        pair: currentPair 
      };
      
      saveToStorage();

      const markerDiv = document.getElementById("tradeMarker");
      markerDiv.className = `trade-marker ${side}`;
      markerDiv.innerHTML = `
        <div class="countdown">00:00</div>
        <div class="entry-price">${side.toUpperCase()} @ ${entryPrice.toFixed(5)}</div>
        <div class="entry-price">$${amount.toFixed(2)}</div>
      `;
      markerDiv.style.top = "50%";
      markerDiv.style.transform = "translateY(-50%)";
      
      startCountdown(duration);
      
      document.getElementById("buyBtn").disabled = true;
      document.getElementById("sellBtn").disabled = true;
    }

    function settleTrade(finalPrice) {
      if (!activeTrade) return;
      
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }

      const { side, amount, entryPrice } = activeTrade;
      const won = (side === "buy" && finalPrice > entryPrice) || (side === "sell" && finalPrice < entryPrice);
      const profit = amount * 0.95;
      const total = won ? amount + profit : 0;

      if (won) {
        balance += total;
        stats.wins++;
        alert(`🎉 YOU WON!\n\nEntry: $${entryPrice.toFixed(5)}\nExit: $${finalPrice.toFixed(5)}\nProfit: +$${profit.toFixed(2)}\nTotal Credited: $${total.toFixed(2)}`);
      } else {
        stats.losses++;
        alert(`❌ YOU LOST!\n\nEntry: $${entryPrice.toFixed(5)}\nExit: $${finalPrice.toFixed(5)}\nLoss: -$${amount.toFixed(2)}`);
      }

      stats.total++;
      updateBalanceDisplay();
      updateStatsDisplay();

      if (tradeLineDataset) {
        const index = liveChart.data.datasets.indexOf(tradeLineDataset);
        if (index > -1) {
          liveChart.data.datasets.splice(index, 1);
        }
        tradeLineDataset = null;
        liveChart.update();
      }

      document.getElementById("tradeMarker").innerHTML = "";
      activeTrade = null;
      saveToStorage();
      
      document.getElementById("buyBtn").disabled = false;
      document.getElementById("sellBtn").disabled = false;
    }

    function restoreActiveTrade() {
      if (activeTrade) {
        const now = Date.now();
        if (now >= activeTrade.endTime) {
          const finalPrice = liveChart.data.datasets[0].data.slice(-1)[0];
          settleTrade(finalPrice);
        } else {
          tradeLineDataset = {
            label: activeTrade.side === "buy" ? "BUY Entry" : "SELL Entry",
            data: Array(500).fill(activeTrade.entryPrice),
            borderColor: activeTrade.side === "buy" ? "#00ff88" : "#ff4444",
            borderWidth: 2,
            borderDash: [5, 5],
            pointRadius: 0,
            fill: false,
          };
          
          liveChart.data.datasets.push(tradeLineDataset);
          liveChart.update();

          const markerDiv = document.getElementById("tradeMarker");
          markerDiv.className = `trade-marker ${activeTrade.side}`;
          markerDiv.innerHTML = `
            <div class="countdown">00:00</div>
            <div class="entry-price">${activeTrade.side.toUpperCase()} @ ${activeTrade.entryPrice.toFixed(5)}</div>
            <div class="entry-price">$${activeTrade.amount.toFixed(2)}</div>
          `;
          markerDiv.style.top = "50%";
          markerDiv.style.transform = "translateY(-50%)";
          
          startCountdown(Math.ceil((activeTrade.endTime - now) / 1000));
          
          document.getElementById("buyBtn").disabled = true;
          document.getElementById("sellBtn").disabled = true;
        }
      }
    }

    document.getElementById("buyBtn").addEventListener("click", () => startTrade("buy"));
    document.getElementById("sellBtn").addEventListener("click", () => startTrade("sell"));

    // Set current pair in dropdown
    document.getElementById("trade").value = currentPair;

    // Initialize
    simulateMissedUpdates();
    updateBalanceDisplay();
    updateStatsDisplay();
    restoreActiveTrade();
    updateChart();

    // Save before page unload
    window.addEventListener('beforeunload', () => {
      saveToStorage();
    });
  </script>
</body>
</html>